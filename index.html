<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OpenClaw Web Demo</title>
    <style>
      body { font-family: system-ui, sans-serif; max-width: 900px; margin: 24px auto; padding: 0 16px; }
      textarea { width: 100%; height: 90px; }
      pre { background: #111; color: #eee; padding: 12px; overflow: auto; }
      .row { display: flex; gap: 8px; align-items: center; }
      input[type=password] { flex: 1; }
      button { padding: 8px 12px; }
    </style>
  </head>
  <body>
    <h1>OpenClaw Web Demo</h1>

    <p>Backend base URL (your Node server):</p>
    <input id="base" style="width:100%" value="" placeholder="https://yourdomain.com" />

    <p>API key (DEMO_API_KEY):</p>
    <div class="row">
      <input id="key" type="password" placeholder="paste your DEMO_API_KEY" />
      <button id="save">Save</button>
    </div>

    <p>Message:</p>
    <textarea id="msg">你好，星期五</textarea>

    <div class="row">
      <button id="send">Send (HTTP)</button>
      <button id="stream">Stream (SSE)</button>
    </div>

    <h3>Output</h3>
    <pre id="out"></pre>

    <script>
      const $ = (id) => document.getElementById(id);
      const out = $('out');

      // persist in browser for convenience
      $('base').value = localStorage.getItem('base') || '';
      $('key').value = localStorage.getItem('key') || '';

      $('save').onclick = () => {
        localStorage.setItem('base', $('base').value.trim());
        localStorage.setItem('key', $('key').value.trim());
        out.textContent = 'saved';
      };

      function headers() {
        return { 'content-type': 'application/json', 'authorization': `Bearer ${$('key').value.trim()}` };
      }

      $('send').onclick = async () => {
        out.textContent = '';
        const base = $('base').value.trim();
        const r = await fetch(base + '/api/chat', {
          method: 'POST',
          headers: headers(),
          body: JSON.stringify({ text: $('msg').value })
        });
        const j = await r.json().catch(() => ({}));
        out.textContent = JSON.stringify({ status: r.status, body: j }, null, 2);
      };

      $('stream').onclick = async () => {
        out.textContent = '';
        const base = $('base').value.trim();
        const text = encodeURIComponent($('msg').value);
        const r = await fetch(base + '/api/chat/stream?text=' + text, { headers: { 'authorization': `Bearer ${$('key').value.trim()}` } });
        if (!r.ok) {
          out.textContent = 'HTTP ' + r.status + ' ' + await r.text();
          return;
        }
        const reader = r.body.getReader();
        const dec = new TextDecoder();
        let buf = '';
        while (true) {
          const { value, done } = await reader.read();
          if (done) break;
          buf += dec.decode(value, { stream: true });
          out.textContent = buf;
        }
      };
    </script>
  </body>
</html>
